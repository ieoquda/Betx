<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BetX - Nepali Casino</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary: #0a192f;
      --secondary: #0d3b66;
      --accent: #00b4d8;
      --neon: #00f5ff;
      --success: #00ff9d;
      --danger: #ff4757;
      --warning: #ffa502;
      --text: #e6f1ff;
      --card-bg: rgba(10, 25, 47, 0.8);
      --shadow: 0 10px 30px rgba(0, 180, 216, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--primary);
      color: var(--text);
      overflow-x: hidden;
      height: 100vh;
      position: relative;
    }

    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }

    .hidden {
      display: none !important;
    }

    /* ===== LOADING SCREEN ===== */
    .loading-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      z-index: 1000;
    }

    .loader {
      width: 60px;
      height: 60px;
      border: 4px solid var(--neon);
      border-top: 4px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-screen p {
      font-size: 18px;
      color: var(--neon);
      text-shadow: 0 0 10px var(--neon);
    }

    /* ===== AUTH SCREEN ===== */
    #auth-screen {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .auth-container {
      text-align: center;
      background: rgba(0, 0, 0, 0.4);
      padding: 40px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 180, 216, 0.2);
      box-shadow: var(--shadow);
      max-width: 350px;
    }

    .auth-container h1 {
      font-size: 36px;
      margin-bottom: 10px;
      color: var(--neon);
      text-shadow: 0 0 15px var(--neon);
    }

    .auth-container p {
      color: var(--text);
      margin-bottom: 30px;
      font-size: 16px;
    }

    .auth-container input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      font-size: 16px;
      border: 1px solid rgba(0, 180, 216, 0.3);
      outline: none;
    }

    .auth-container button {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--neon));
      color: var(--primary);
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 5px 15px rgba(0, 180, 216, 0.4);
    }

    .auth-container button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 180, 216, 0.6);
    }

    .message {
      margin-top: 15px;
      font-size: 14px;
      min-height: 20px;
    }

    .message.success {
      color: var(--success);
      text-shadow: 0 0 8px var(--success);
    }

    .message.error {
      color: var(--danger);
      text-shadow: 0 0 8px var(--danger);
    }

    /* ===== HEADER ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(0, 180, 216, 0.2);
    }

    .account-id, .balance {
      font-size: 14px;
      font-weight: 500;
      color: var(--neon);
      text-shadow: 0 0 5px rgba(0, 180, 216, 0.5);
    }

    .balance {
      color: var(--success);
    }

    /* ===== LEADERBOARD ===== */
    .leaderboard {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0, 180, 216, 0.2);
    }

    .leaderboard h2 {
      text-align: center;
      color: var(--neon);
      margin-bottom: 15px;
      font-size: 18px;
      text-shadow: 0 0 10px var(--neon);
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border-left: 4px solid var(--accent);
    }

    .leaderboard-item:nth-child(1) { border-left-color: #ffd700; }
    .leaderboard-item:nth-child(2) { border-left-color: #c0c0c0; }
    .leaderboard-item:nth-child(3) { border-left-color: #cd7f32; }

    .rank {
      font-weight: bold;
      color: var(--neon);
    }

    .name {
      flex-grow: 1;
      margin-left: 10px;
    }

    .winnings {
      color: var(--success);
      font-weight: bold;
    }

    /* ===== BONUS WHEEL ===== */
    .bonus-wheel {
      margin-bottom: 20px;
      text-align: center;
    }

    .wheel-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 20px;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at center, var(--primary), var(--secondary));
      border: 3px solid var(--neon);
      box-shadow: 0 0 20px rgba(0, 180, 216, 0.5);
      position: relative;
      overflow: hidden;
      transition: transform 3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .wheel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        from 0deg,
        #ff4757 0% 10%, 
        #ffa502 10% 20%, 
        #ffdd00 20% 30%, 
        #00ff9d 30% 40%, 
        #00b4d8 40% 50%, 
        #00f5ff 50% 60%, 
        #9d4edd 60% 70%, 
        #ff4757 70% 100%
      );
    }

    .pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 20px solid var(--neon);
      z-index: 10;
    }

    .spin-btn {
      background: linear-gradient(135deg, var(--accent), var(--neon));
      color: var(--primary);
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 5px 15px rgba(0, 180, 216, 0.4);
      transition: all 0.3s ease;
    }

    .spin-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 180, 216, 0.6);
    }

    /* ===== BOTTOM NAV ===== */
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      background: rgba(10, 25, 47, 0.9);
      padding: 10px 0;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      border-top: 1px solid rgba(0, 180, 216, 0.3);
      z-index: 100;
    }

    .nav-btn {
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-btn.active {
      background: rgba(0, 180, 216, 0.3);
      color: var(--neon);
      box-shadow: 0 0 10px rgba(0, 180, 216, 0.5);
    }

    .nav-btn:hover:not(.active) {
      background: rgba(255, 255, 255, 0.1);
    }

    /* ===== GAMES SECTION ===== */
    .game-selector {
      display: flex;
      margin-bottom: 20px;
      justify-content: center;
      gap: 10px;
    }

    .game-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(0, 180, 216, 0.3);
      color: var(--text);
      padding: 12px 20px;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .game-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--neon));
      color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 180, 216, 0.5);
    }

    .game-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0, 180, 216, 0.2);
      margin-bottom: 20px;
    }

    /* ===== AVIATOR GAME ===== */
    .aviator-bg {
      position: relative;
      width: 100%;
      height: 250px;
      background: linear-gradient(to bottom, #0a192f, #1a2c4d);
      border-radius: 15px;
      margin-bottom: 20px;
      overflow: hidden;
      perspective: 1000px;
    }

    .runway {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background: linear-gradient(to right, #333, #222, #333);
      background-size: 40px 40px;
      animation: runway-move 2s linear infinite;
    }

    @keyframes runway-move {
      0% { background-position: 0 0; }
      100% { background-position: 40px 0; }
    }

    .plane {
      position: absolute;
      bottom: 50px;
      left: 20px;
      width: 60px;
      height: 30px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50"><path d="M10,25 L40,10 L70,10 L80,25 L70,40 L40,40 Z" fill="%2300b4d8"/><circle cx="85" cy="25" r="5" fill="%23fff"/><path d="M40,10 L45,25 L40,40" stroke="%2300f5ff" stroke-width="2" fill="none"/></svg>');
      background-repeat: no-repeat;
      background-size: contain;
      transition: transform 0.1s linear;
      transform-origin: center bottom;
      filter: drop-shadow(0 0 10px rgba(0, 180, 216, 0.8));
    }

    .aviator-controls {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .aviator-controls input {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      font-size: 16px;
      border: 1px solid rgba(0, 180, 216, 0.3);
      outline: none;
    }

    .aviator-controls button {
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #aviator-bet-btn {
      background: linear-gradient(135deg, #00b4d8, #00f5ff);
      color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 180, 216, 0.4);
    }

    #aviator-cashout {
      background: linear-gradient(135deg, #00ff9d, #00ffcc);
      color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 255, 157, 0.4);
    }

    #aviator-cashout:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .multiplier {
      font-size: 32px;
      font-weight: bold;
      color: var(--neon);
      text-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
      margin: 10px 0;
      text-align: center;
    }

    .status {
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .status.warning {
      background: rgba(255, 165, 2, 0.2);
      color: var(--warning);
      border: 1px solid var(--warning);
    }

    .status.success {
      background: rgba(0, 255, 157, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .status.error {
      background: rgba(255, 71, 87, 0.2);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    /* ===== MINES GAME ===== */
    .mines-header {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .mines-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      width: 100%;
      margin-bottom: 20px;
    }

    .mine-tile {
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      position: relative;
      perspective: 1000px;
      border: 1px solid rgba(0, 180, 216, 0.3);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .mine-tile:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 180, 216, 0.4);
    }

    .mine-tile.flipped {
      transform: rotateY(180deg);
    }

    .mine-tile .face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      border-radius: 10px;
      transition: transform 0.4s;
    }

    .mine-tile .front {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
    }

    .mine-tile .back {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      transform: rotateY(180deg);
    }

    .mine-tile .gem {
      color: #00ff9d;
      font-size: 32px;
    }

    .mine-tile .mine {
      color: #ff4757;
      font-size: 32px;
    }

    .mines-multiplier {
      font-size: 28px;
      font-weight: bold;
      color: var(--neon);
      text-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
      margin: 10px 0;
      text-align: center;
    }

    /* ===== HISTORY SCREEN ===== */
    .filter-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center;
    }

    .filter-bar select, .filter-bar button {
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      font-size: 14px;
    }

    .history-list {
      flex: 1;
      overflow-y: auto;
      max-height: 400px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border-left: 4px solid var(--accent);
    }

    .history-item.win {
      border-left-color: var(--success);
    }

    .history-item.loss {
      border-left-color: var(--danger);
    }

    .history-game {
      font-weight: bold;
      color: var(--neon);
    }

    .history-amount {
      font-weight: bold;
    }

    .history-win {
      color: var(--success);
    }

    .history-loss {
      color: var(--danger);
    }

    .history-time {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
    }

    /* ===== ACCOUNT SCREEN ===== */
    .account-info {
      background: var(--card-bg);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0, 180, 216, 0.2);
    }

    .account-info h2 {
      text-align: center;
      color: var(--neon);
      margin-bottom: 20px;
      font-size: 20px;
      text-shadow: 0 0 10px var(--neon);
    }

    .account-info p {
      margin: 12px 0;
      line-height: 1.6;
    }

    .deposit-withdraw {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .deposit-withdraw button {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .deposit-btn {
      background: linear-gradient(135deg, #00ff9d, #00ffcc);
      color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 255, 157, 0.4);
    }

    .withdraw-btn {
      background: linear-gradient(135deg, #ff4757, #ff6b81);
      color: white;
      box-shadow: 0 5px 15px rgba(255, 71, 87, 0.5);
    }

    .transaction-history {
      margin-top: 20px;
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .transaction-type {
      font-weight: bold;
    }

    .transaction-amount {
      font-weight: bold;
    }

    .transaction-deposit {
      color: var(--success);
    }

    .transaction-withdraw {
      color: var(--danger);
    }

    .transaction-status {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
    }

    /* ===== MODALS ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 180, 216, 0.5);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-overlay.show .modal {
      transform: scale(1);
    }

    .modal h3 {
      color: var(--neon);
      margin-bottom: 20px;
      font-size: 22px;
      text-shadow: 0 0 10px var(--neon);
    }

    .modal button {
      margin-top: 15px;
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .modal button.confirm {
      background: linear-gradient(135deg, #00b4d8, #00f5ff);
      color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 180, 216, 0.4);
    }

    .modal button.cancel {
      background: transparent;
      border: 1px solid var(--neon);
      color: var(--neon);
    }

    /* ===== ANIMATIONS ===== */
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 480px) {
      .auth-container { padding: 20px; }
      .header { flex-direction: column; gap: 5px; }
      .account-id, .balance { font-size: 12px; }
      .leaderboard h2 { font-size: 16px; }
      .game-selector { flex-wrap: wrap; }
      .game-btn { flex: 1; }
      .aviator-bg { height: 200px; }
      .mines-grid { gap: 5px; }
      .mine-tile { font-size: 20px; }
      .multiplier { font-size: 24px; }
      .mines-multiplier { font-size: 24px; }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading" class="loading-screen">
    <div class="loader"></div>
    <p>Loading BetX...</p>
  </div>

  <!-- Login / Register Screen -->
  <div id="auth-screen" class="screen">
    <div class="auth-container">
      <h1>BetX</h1>
      <p>Nepal's Most Addictive Casino</p>
      <div id="auth-form">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <button id="login-btn">Login</button>
        <button id="register-btn">Register</button>
        <p id="auth-message" class="message"></p>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home-screen" class="screen hidden">
    <div class="header">
      <span class="account-id">UID: <span id="user-id">Loading...</span></span>
      <span class="balance">NPR <span id="balance">0</span></span>
    </div>

    <div class="leaderboard">
      <h2>🏆 Top Nepali Players</h2>
      <div id="leaderboard-list"></div>
    </div>

    <div class="bonus-wheel" id="daily-spin" style="display:none;">
      <div class="wheel-container">
        <div class="wheel"></div>
        <div class="pointer"></div>
        <button class="spin-btn">Spin Bonus!</button>
      </div>
    </div>

    <nav class="bottom-nav">
      <button class="nav-btn active" data-screen="home">🏠 Home</button>
      <button class="nav-btn" data-screen="games">🎮 Games</button>
      <button class="nav-btn" data-screen="history">📜 History</button>
      <button class="nav-btn" data-screen="account">👤 Account</button>
    </nav>
  </div>

  <!-- Games Screen -->
  <div id="games-screen" class="screen hidden">
    <div class="header">
      <span class="account-id">UID: <span id="game-user-id">Loading...</span></span>
      <span class="balance">NPR <span id="game-balance">0</span></span>
    </div>

    <div class="game-selector">
      <button class="game-btn active" data-game="aviator">🚀 Aviator</button>
      <button class="game-btn" data-game="mines">💣 Mines</button>
    </div>

    <div class="game-container">
      <!-- Aviator Game -->
      <div id="aviator-game" class="game-section hidden">
        <div class="aviator-bg">
          <div class="runway"></div>
          <div class="plane" id="plane"></div>
        </div>
        <div class="aviator-controls">
          <input type="number" id="aviator-bet" placeholder="Enter Bet (NPR)" min="10" value="100" />
          <button id="aviator-bet-btn">Bet</button>
          <button id="aviator-cashout" disabled>Cash Out: 1.00x</button>
          <div id="aviator-multiplier" class="multiplier">1.00x</div>
          <div id="aviator-status" class="status"></div>
        </div>
      </div>

      <!-- Mines Game -->
      <div id="mines-game" class="game-section hidden">
        <div class="mines-header">
          <input type="number" id="mines-bet" placeholder="Enter Bet (NPR)" min="10" value="100" />
          <button id="mines-start-btn">Start Game</button>
          <div id="mines-multiplier" class="multiplier">1.00x</div>
          <div id="mines-status" class="status"></div>
        </div>
        <div class="mines-grid" id="mines-grid"></div>
      </div>
    </div>

    <nav class="bottom-nav">
      <button class="nav-btn" data-screen="home">🏠 Home</button>
      <button class="nav-btn active" data-screen="games">🎮 Games</button>
      <button class="nav-btn" data-screen="history">📜 History</button>
      <button class="nav-btn" data-screen="account">👤 Account</button>
    </nav>
  </div>

  <!-- History Screen -->
  <div id="history-screen" class="screen hidden">
    <div class="header">
      <span class="account-id">UID: <span id="history-user-id">Loading...</span></span>
      <span class="balance">NPR <span id="history-balance">0</span></span>
    </div>

    <div class="filter-bar">
      <select id="history-filter">
        <option value="all">All Games</option>
        <option value="aviator">Aviator</option>
        <option value="mines">Mines</option>
      </select>
      <button id="clear-history">Clear</button>
    </div>

    <div id="history-list" class="history-list"></div>

    <nav class="bottom-nav">
      <button class="nav-btn" data-screen="home">🏠 Home</button>
      <button class="nav-btn" data-screen="games">🎮 Games</button>
      <button class="nav-btn active" data-screen="history">📜 History</button>
      <button class="nav-btn" data-screen="account">👤 Account</button>
    </nav>
  </div>

  <!-- Account Screen -->
  <div id="account-screen" class="screen hidden">
    <div class="header">
      <span class="account-id">UID: <span id="account-user-id">Loading...</span></span>
      <span class="balance">NPR <span id="account-balance">0</span></span>
    </div>

    <div class="account-info">
      <h2>Account Details</h2>
      <p><strong>Name:</strong> <span id="user-name">Anonymous</span></p>
      <p><strong>Account #:</strong> <span id="account-number">Loading...</span></p>
      <p><strong>Balance:</strong> NPR <span id="account-balance-display">0</span></p>
    </div>

    <div class="deposit-withdraw">
      <button class="deposit-btn" id="deposit-btn">Deposit</button>
      <button class="withdraw-btn" id="withdraw-btn">Withdraw</button>
    </div>

    <div class="transaction-history">
      <h3>Transaction History</h3>
      <div id="transaction-list"></div>
    </div>

    <nav class="bottom-nav">
      <button class="nav-btn" data-screen="home">🏠 Home</button>
      <button class="nav-btn" data-screen="games">🎮 Games</button>
      <button class="nav-btn" data-screen="history">📜 History</button>
      <button class="nav-btn active" data-screen="account">👤 Account</button>
    </nav>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="modal-content">
      <h3 id="modal-title">Modal Title</h3>
      <p id="modal-message">Modal message</p>
      <button class="confirm" id="modal-confirm">OK</button>
      <button class="cancel" id="modal-cancel">Cancel</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>

  <script>
    // ==========================
    // FIREBASE CONFIGURATION
    // ==========================
    const firebaseConfig = {
      apiKey: "AIzaSyCv3gDLEUhuHdMDPc2RX2AzLvihDfmEXgo",
      authDomain: "betx-74dff.firebaseapp.com",
      projectId: "betx-74dff",
      storageBucket: "betx-74dff.firebasestorage.app",
      messagingSenderId: "85279852822",
      appId: "1:85279852822:web:91ef8dad8794d820416837",
      measurementId: "G-NX5D0BF329"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ==========================
    // APP STATE & VARIABLES
    // ==========================
    let currentUser = null;
    let currentScreen = 'auth-screen';
    let aviatorGameActive = false;
    let aviatorMultiplier = 1.00;
    let aviatorFlightTimer = null;
    let minesGameActive = false;
    let minesGrid = [];
    let minesMineCount = 3;
    let minesMultiplier = 1.00;
    let minesRevealed = 0;

    // ==========================
    // UTILITY FUNCTIONS
    // ==========================
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
      
      // Update active nav button
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.nav-btn[data-screen="${screenId.replace('-screen', '')}"]`).classList.add('active');
      
      currentScreen = screenId;
    }

    function showMessage(message, type = 'info') {
      const messageEl = document.getElementById('auth-message');
      messageEl.textContent = message;
      messageEl.className = `message ${type}`;
      setTimeout(() => {
        messageEl.textContent = '';
      }, 3000);
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-NP', {
        style: 'currency',
        currency: 'NPR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount);
    }

    function generateUid() {
      return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }

    // ==========================
    // AUTHENTICATION HANDLERS
    // ==========================
    document.getElementById('login-btn').addEventListener('click', async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        onAuthSuccess(userCredential.user);
      } catch (error) {
        showMessage(error.message, 'error');
      }
    });

    document.getElementById('register-btn').addEventListener('click', async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Create user profile in Firestore
        await db.collection('users').doc(user.uid).set({
          email: email,
          name: email.split('@')[0],
          balance: 1000,
          accountNumber: user.uid.substring(0, 8).toUpperCase(),
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        onAuthSuccess(user);
      } catch (error) {
        showMessage(error.message, 'error');
      }
    });

    function onAuthSuccess(user) {
      currentUser = user;
      localStorage.setItem('currentUser', user.uid);
      
      // Show loading screen briefly
      document.getElementById('loading').style.display = 'flex';
      
      // Load user data from Firestore
      loadUserData(user.uid).then(() => {
        document.getElementById('loading').style.display = 'none';
        showScreen('home-screen');
        showMessage('Logged in successfully', 'success');
      });
    }

    function loadUserData(uid) {
      return db.collection('users').doc(uid).get().then(doc => {
        if (doc.exists) {
          const userData = doc.data();
          
          // Update UI with user data
          document.getElementById('user-id').textContent = uid;
          document.getElementById('balance').textContent = userData.balance || 0;
          document.getElementById('game-user-id').textContent = uid;
          document.getElementById('game-balance').textContent = userData.balance || 0;
          document.getElementById('history-user-id').textContent = uid;
          document.getElementById('history-balance').textContent = userData.balance || 0;
          document.getElementById('account-user-id').textContent = uid;
          document.getElementById('account-balance').textContent = userData.balance || 0;
          document.getElementById('account-number').textContent = userData.accountNumber || uid.substring(0, 8).toUpperCase();
          document.getElementById('user-name').textContent = userData.name || 'Anonymous';
          document.getElementById('account-balance-display').textContent = userData.balance || 0;
          
          // Initialize all screens with balance
          updateAllBalances(userData.balance || 0);
          
          // Load leaderboard
          loadLeaderboard();
          
          // Load history
          loadHistory();
          
          // Load transactions
          loadTransactions();
          
          // Enable daily bonus wheel
          enableDailyBonus();
          
          // Start listening for real-time balance updates
          startRealTimeBalanceListener(uid);
          
          // Initialize games
          initAviatorGame();
          initMinesGame();
        }
      });
    }

    function updateAllBalances(balance) {
      document.getElementById('balance').textContent = balance;
      document.getElementById('game-balance').textContent = balance;
      document.getElementById('history-balance').textContent = balance;
      document.getElementById('account-balance').textContent = balance;
      document.getElementById('account-balance-display').textContent = balance;
    }

    function startRealTimeBalanceListener(uid) {
      db.collection('users').doc(uid).onSnapshot(doc => {
        if (doc.exists) {
          const balance = doc.data().balance || 0;
          updateAllBalances(balance);
        }
      });
    }

    // ==========================
    // NAVIGATION HANDLERS
    // ==========================
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const screenId = btn.getAttribute('data-screen') + '-screen';
        showScreen(screenId);
      });
    });

    // ==========================
    // HOME SCREEN
    // ==========================
    function loadLeaderboard() {
      const leaderboardList = document.getElementById('leaderboard-list');
      leaderboardList.innerHTML = '';
      
      db.collection('users')
        .orderBy('balance', 'desc')
        .limit(5)
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            const user = doc.data();
            const item = document.createElement('div');
            item.className = 'leaderboard-item';
            item.innerHTML = `
              <span class="rank">${['🥇', '🥈', '🥉'][leaderboardList.children.length] || (leaderboardList.children.length + 1)}</span>
              <span class="name">${user.name || 'Anonymous'}</span>
              <span class="winnings">+${formatCurrency(user.balance || 0)}</span>
            `;
            leaderboardList.appendChild(item);
          });
        });
    }

    function enableDailyBonus() {
      const lastSpin = localStorage.getItem('lastBonusSpin');
      const now = Date.now();
      const dayInMillis = 24 * 60 * 60 * 1000;
      
      if (!lastSpin || now - parseInt(lastSpin) >= dayInMillis) {
        document.getElementById('daily-spin').style.display = 'block';
        document.querySelector('#daily-spin .spin-btn').disabled = false;
        document.querySelector('#daily-spin .spin-btn').textContent = 'Spin Bonus!';
        
        document.querySelector('#daily-spin .spin-btn').addEventListener('click', spinBonusWheel, { once: true });
      } else {
        document.getElementById('daily-spin').style.display = 'none';
      }
    }

    function spinBonusWheel() {
      const wheel = document.querySelector('#daily-spin .wheel');
      const spins = 5 + Math.random() * 5; // 5-10 full rotations
      const degrees = spins * 360;
      const prizes = [
        { prize: "500 NPR", value: 500 },
        { prize: "200 NPR", value: 200 },
        { prize: "100 NPR", value: 100 },
        { prize: "50 NPR", value: 50 },
        { prize: "Free Spin!", value: 0 },
        { prize: "2x Multiplier", value: 2 },
        { prize: "1000 NPR", value: 1000 },
        { prize: "100 NPR", value: 100 }
      ];
      
      const randomIndex = Math.floor(Math.random() * prizes.length);
      const prize = prizes[randomIndex];
      
      // Disable button during spin
      document.querySelector('#daily-spin .spin-btn').disabled = true;
      document.querySelector('#daily-spin .spin-btn').textContent = 'Spinning...';
      
      // Animate wheel
      wheel.style.transform = `rotate(${degrees + randomIndex * 45}deg)`;
      
      setTimeout(() => {
        if (prize.value === 0) {
          showMessage("🎉 Free Spin! You'll get a bonus tomorrow!");
        } else if (prize.value === 2) {
          showMessage("🔥 Double multiplier bonus activated for your next game!");
        } else {
          addBalance(prize.value);
          showMessage(`🎉 Congratulations! You won ${formatCurrency(prize.value)}!`);
        }
        
        localStorage.setItem('lastBonusSpin', Date.now().toString());
        document.querySelector('#daily-spin .spin-btn').disabled = false;
        document.querySelector('#daily-spin .spin-btn').textContent = 'Spin Bonus!';
      }, 3000);
    }

    // ==========================
    // AVIATOR GAME
    // ==========================
    function initAviatorGame() {
      const plane = document.getElementById('plane');
      const betBtn = document.getElementById('aviator-bet-btn');
      const cashoutBtn = document.getElementById('aviator-cashout');
      const multiplierDisplay = document.getElementById('aviator-multiplier');
      const statusDisplay = document.getElementById('aviator-status');
      const betInput = document.getElementById('aviator-bet');
      
      // Reset state
      aviatorGameActive = false;
      aviatorMultiplier = 1.00;
      aviatorFlightTimer = null;
      
      // Event listeners
      betBtn.addEventListener('click', () => {
        if (aviatorGameActive) return;
        
        const betAmount = parseFloat(betInput.value) || 0;
        if (betAmount < 10) {
          showMessage("Minimum bet is NPR 10", "error");
          return;
        }
        
        // Check balance
        if (getCurrentBalance() < betAmount) {
          showMessage("Insufficient balance", "error");
          return;
        }
        
        // Deduct bet
        deductBalance(betAmount);
        
        // Start flight
        aviatorGameActive = true;
        aviatorMultiplier = 1.00;
        betBtn.disabled = true;
        cashoutBtn.disabled = false;
        statusDisplay.textContent = "Plane taking off...";
        statusDisplay.className = "status";
        
        // Animate plane
        plane.style.transition = "none";
        plane.style.bottom = "50px";
        plane.style.left = "20px";
        
        // Simulate flight with increasing multiplier
        let timeElapsed = 0;
        const interval = 100; // ms
        const speedFactor = 0.05;
        
        aviatorFlightTimer = setInterval(() => {
          timeElapsed += interval / 1000;
          aviatorMultiplier = 1.00 + (Math.pow(timeElapsed, 1.5) * speedFactor * 10);
          
          // Cap multiplier at 100x
          if (aviatorMultiplier > 100) aviatorMultiplier = 100;
          
          // Update display
          multiplierDisplay.textContent = aviatorMultiplier.toFixed(2) + 'x';
          
          // Randomly determine if plane flies away (1% chance per second after 2 seconds)
          if (timeElapsed > 2 && Math.random() < 0.01) {
            endAviatorRound(false);
          }
        }, interval);
      });
      
      cashoutBtn.addEventListener('click', () => {
        if (!aviatorGameActive) return;
        endAviatorRound(true);
      });
      
      // Function to end the round
      function endAviatorRound(cashedOut) {
        clearInterval(aviatorFlightTimer);
        aviatorGameActive = false;
        betBtn.disabled = false;
        cashoutBtn.disabled = true;
        
        if (cashedOut) {
          const winnings = Math.round((parseFloat(betInput.value) || 0) * aviatorMultiplier);
          addBalance(winnings);
          saveTransaction('aviator', parseFloat(betInput.value), winnings, 'win');
          statusDisplay.textContent = `Cash Out! +${formatCurrency(winnings)}`;
          statusDisplay.className = "status success";
          showMessage(`You cashed out at ${aviatorMultiplier.toFixed(2)}x and won ${formatCurrency(winnings)}!`, "success");
        } else {
          statusDisplay.textContent = "Plane flew away! You lost!";
          statusDisplay.className = "status error";
          saveTransaction('aviator', parseFloat(betInput.value), 0, 'loss');
          showMessage("The plane flew away! You lost your bet.", "error");
        }
        
        // Reset multiplier
        aviatorMultiplier = 1.00;
        multiplierDisplay.textContent = "1.00x";
        
        // Reset plane position
        setTimeout(() => {
          plane.style.transition = "transform 1s ease-out";
          plane.style.transform = "scale(1)";
        }, 500);
      }
    }

    // ==========================
    // MINES GAME
    // ==========================
    function initMinesGame() {
      const grid = document.getElementById('mines-grid');
      const betBtn = document.getElementById('mines-start-btn');
      const multiplierDisplay = document.getElementById('mines-multiplier');
      const statusDisplay = document.getElementById('mines-status');
      const betInput = document.getElementById('mines-bet');
      
      // Reset state
      minesGameActive = false;
      minesMultiplier = 1.00;
      minesRevealed = 0;
      minesGrid = [];
      
      // Clear grid
      grid.innerHTML = '';
      
      // Generate mine positions
      const createGrid = () => {
        minesGrid = Array(25).fill(false); // false = gem, true = mine
        const minePositions = [];
        
        while (minePositions.length < minesMineCount) {
          const pos = Math.floor(Math.random() * 25);
          if (!minePositions.includes(pos)) {
            minePositions.push(pos);
            minesGrid[pos] = true;
          }
        }
        
        // Create tiles
        for (let i = 0; i < 25; i++) {
          const tile = document.createElement('div');
          tile.className = 'mine-tile';
          tile.dataset.index = i;
          
          tile.innerHTML = `
            <div class="face front">?</div>
            <div class="face back">
              ${minesGrid[i] ? '💣' : '💎'}
            </div>
          `;
          
          tile.addEventListener('click', () => revealTile(i));
          grid.appendChild(tile);
        }
      };
      
      // Reveal tile
      function revealTile(index) {
        if (!minesGameActive) return;
        
        const tile = document.querySelector(`.mine-tile[data-index="${index}"]`);
        if (tile.classList.contains('flipped')) return;
        
        tile.classList.add('flipped');
        minesRevealed++;
        
        if (minesGrid[index]) {
          // Mine hit!
          minesGameActive = false;
          statusDisplay.textContent = "💥 BOOM! You hit a mine!";
          statusDisplay.className = "status error";
          saveTransaction('mines', parseFloat(betInput.value), 0, 'loss');
          showMessage("You hit a mine and lost your bet!", "error");
          return;
        } else {
          // Gem revealed
          minesMultiplier = 1.00 + (minesRevealed * 0.5);
          multiplierDisplay.textContent = minesMultiplier.toFixed(2) + 'x';
          
          // Win condition: All gems found
          if (minesRevealed === (25 - minesMineCount)) {
            minesGameActive = false;
            const winnings = Math.round((parseFloat(betInput.value) || 0) * minesMultiplier);
            addBalance(winnings);
            saveTransaction('mines', parseFloat(betInput.value), winnings, 'win');
            statusDisplay.textContent = `🎉 ALL SAFE! Won ${formatCurrency(winnings)}!`;
            statusDisplay.className = "status success";
            showMessage(`You revealed all gems and won ${formatCurrency(winnings)}!`, "success");
          }
        }
      }
      
      // Start game
      betBtn.addEventListener('click', () => {
        if (minesGameActive) return;
        
        const betAmount = parseFloat(betInput.value) || 0;
        if (betAmount < 10) {
          showMessage("Minimum bet is NPR 10", "error");
          return;
        }
        
        // Check balance
        if (getCurrentBalance() < betAmount) {
          showMessage("Insufficient balance", "error");
          return;
        }
        
        // Deduct bet
        deductBalance(betAmount);
        
        // Start game
        minesGameActive = true;
        minesMultiplier = 1.00;
        minesRevealed = 0;
        multiplierDisplay.textContent = "1.00x";
        statusDisplay.textContent = "Select safe tiles!";
        statusDisplay.className = "status";
        
        createGrid();
        betBtn.disabled = true;
      });
    }

    // ==========================
    // HISTORY SCREEN
    // ==========================
    function loadHistory() {
      const historyList = document.getElementById('history-list');
      historyList.innerHTML = '';
      
      const filter = document.getElementById('history-filter').value;
      
      let query = db.collection('transactions')
        .where('userId', '==', currentUser.uid)
        .orderBy('timestamp', 'desc')
        .limit(20);
      
      if (filter !== 'all') {
        query = query.where('game', '==', filter);
      }
      
      query.get().then(snapshot => {
        snapshot.forEach(doc => {
          const transaction = doc.data();
          const item = document.createElement('div');
          item.className = `history-item ${transaction.outcome}`;
          item.innerHTML = `
            <div>
              <span class="history-game">${transaction.game.toUpperCase()}</span>
              <br>
              <span class="history-time">${new Date(transaction.timestamp.toDate()).toLocaleString('en-NP')}</span>
            </div>
            <div>
              <span class="history-amount">${formatCurrency(transaction.betAmount)}</span>
              <br>
              <span class="${transaction.outcome === 'win' ? 'history-win' : 'history-loss'}">
                ${transaction.outcome === 'win' ? '+' : ''}${formatCurrency(transaction.winnings)}
              </span>
            </div>
          `;
          historyList.appendChild(item);
        });
      });
    }

    document.getElementById('history-filter').addEventListener('change', loadHistory);
    
    document.getElementById('clear-history').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear your transaction history? This cannot be undone.')) {
        db.collection('transactions')
          .where('userId', '==', currentUser.uid)
          .get()
          .then(snapshot => {
            const batch = db.batch();
            snapshot.docs.forEach(doc => {
              batch.delete(doc.ref);
            });
            return batch.commit();
          })
          .then(() => {
            loadHistory();
            showMessage("History cleared!", "success");
          })
          .catch(err => {
            showMessage("Error clearing history: " + err.message, "error");
          });
      }
    });

    // ==========================
    // ACCOUNT SCREEN
    // ==========================
    function loadTransactions() {
      const transactionList = document.getElementById('transaction-list');
      transactionList.innerHTML = '';
      
      db.collection('transactions')
        .where('userId', '==', currentUser.uid)
        .orderBy('timestamp', 'desc')
        .limit(10)
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            const tx = doc.data();
            const item = document.createElement('div');
            item.className = 'transaction-item';
            item.innerHTML = `
              <div>
                <span class="transaction-type">${tx.game.toUpperCase()}</span>
                <br>
                <span class="transaction-time">${new Date(tx.timestamp.toDate()).toLocaleTimeString('en-NP')}</span>
              </div>
              <div>
                <span class="transaction-amount ${tx.outcome === 'win' ? 'transaction-deposit' : 'transaction-withdraw'}">
                  ${tx.outcome === 'win' ? '+' : ''}${formatCurrency(tx.winnings || tx.betAmount)}
                </span>
              </div>
            `;
            transactionList.appendChild(item);
          });
        });
    }

    document.getElementById('deposit-btn').addEventListener('click', () => {
      showModal('Deposit Funds', 'Enter amount to deposit:', 'Deposit', 'Cancel', (amount) => {
        const depositAmount = parseFloat(amount);
        if (depositAmount <= 0) {
          showMessage("Please enter a valid amount", "error");
          return;
        }
        
        // Simulate deposit - in real app, this would connect to payment gateway
        addBalance(depositAmount);
        saveTransaction('deposit', depositAmount, depositAmount, 'win');
        showMessage(`Successfully deposited ${formatCurrency(depositAmount)}!`, "success");
      });
    });

    document.getElementById('withdraw-btn').addEventListener('click', () => {
      showModal('Withdraw Funds', 'Enter amount to withdraw:', 'Withdraw', 'Cancel', (amount) => {
        const withdrawAmount = parseFloat(amount);
        const currentBalance = getCurrentBalance();
        
        if (withdrawAmount <= 0) {
          showMessage("Please enter a valid amount", "error");
          return;
        }
        
        if (withdrawAmount > currentBalance) {
          showMessage("Insufficient balance", "error");
          return;
        }
        
        // Simulate withdrawal request
        deductBalance(withdrawAmount);
        saveTransaction('withdraw', withdrawAmount, 0, 'loss');
        showMessage(`Withdrawal request of ${formatCurrency(withdrawAmount)} submitted. Processing in 24 hours.`, "success");
      });
    });

    function showModal(title, message, confirmText, cancelText, onConfirm) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-message').textContent = message;
      document.getElementById('modal-confirm').textContent = confirmText;
      document.getElementById('modal-cancel').textContent = cancelText;
      
      const modal = document.getElementById('modal-overlay');
      modal.classList.add('show');
      
      document.getElementById('modal-confirm').onclick = () => {
        const input = prompt(message, '');
        if (input !== null && input.trim() !== '') {
          onConfirm(input.trim());
        }
        modal.classList.remove('show');
      };
      
      document.getElementById('modal-cancel').onclick = () => {
        modal.classList.remove('show');
      };
    }

    // ==========================
    // FIRESTORE TRANSACTIONS
    // ==========================
    function saveTransaction(game, betAmount, winnings, outcome) {
      db.collection('transactions').add({
        userId: currentUser.uid,
        game: game,
        betAmount: betAmount,
        winnings: winnings,
        outcome: outcome,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    }

    // ==========================
    // BALANCE MANAGEMENT
    // ==========================
    function getCurrentBalance() {
      return parseFloat(document.getElementById('balance').textContent) || 0;
    }

    function addBalance(amount) {
      if (!currentUser) return;
      
      db.collection('users').doc(currentUser.uid).update({
        balance: firebase.firestore.FieldValue.increment(amount)
      });
    }

    function deductBalance(amount) {
      if (!currentUser) return;
      
      db.collection('users').doc(currentUser.uid).update({
        balance: firebase.firestore.FieldValue.increment(-amount)
      });
    }

    // ==========================
    // AUTH LISTENER
    // ==========================
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        localStorage.setItem('currentUser', user.uid);
        
        // If already on login screen, redirect to home
        if (currentScreen === 'auth-screen') {
          showScreen('home-screen');
          loadUserData(user.uid);
        }
      } else {
        // User signed out
        currentUser = null;
        localStorage.removeItem('currentUser');
        showScreen('auth-screen');
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
      }
    });

    // ==========================
    // INITIALIZE APP
    // ==========================
    window.addEventListener('DOMContentLoaded', () => {
      // Check if user is already logged in
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()) // Dummy call to trigger auth state
          .catch(() => {
            // Try to sign in with saved UID
            db.collection('users').doc(savedUser).get().then(doc => {
              if (doc.exists) {
                currentUser = { uid: savedUser };
                showScreen('home-screen');
                loadUserData(savedUser);
              } else {
                localStorage.removeItem('currentUser');
              }
            });
          });
      }
      
      // Initialize game screens
      document.querySelectorAll('.game-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.game-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const game = btn.dataset.game;
          document.querySelectorAll('.game-section').forEach(section => {
            section.classList.add('hidden');
          });
          document.getElementById(`${game}-game`).classList.remove('hidden');
        });
      });
      
      // Initialize Firebase auth state listener
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          localStorage.setItem('currentUser', user.uid);
          
          if (currentScreen === 'auth-screen') {
            showScreen('home-screen');
            loadUserData(user.uid);
          }
        } else {
          // User signed out
          currentUser = null;
          localStorage.removeItem('currentUser');
          if (currentScreen !== 'auth-screen') {
            showScreen('auth-screen');
          }
        }
      });
      
      // Hide loading screen after 1.5s
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
      }, 1500);
    });

    // Prevent form submission on Enter
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
